#!/bin/bash
set -euo pipefail

: "${NOTES_DIR:?NOTES_DIR is not set or empty}"

if [[ ! -d "$NOTES_DIR" ]]; then
  echo "NOTES_DIR does not exist or is not a directory: $NOTES_DIR" >&2
  exit 1
fi

if [ ! -d "$HOME/notes/" ]; then
	echo "Error: No notes directory at HOME folder"
	exit 1
fi

if [ -z "$1" ]; then
    read -p "Note name: " note_name
    if [ -z "$note_name" ]; then
        echo "Error: Note name required"
        exit 1
    fi
else
    note_name="$*"
fi

fn="$(date "+%Y-%m-%d")_$(echo "$note_name" | tr ' ' '-').md"

fp="$NOTES_DIR/notes/inbox/$fn"

touch "$fp"
nvim -c "cd $(printf '%q' "$NOTES_DIR/notes")" "$fp"
